<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MyBookShare Inventory</title>
  <!-- Load Tesseract.js, EmailJS, and Supabase from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    (function() {
      // Initialize EmailJS
      emailjs.init('mStUPqb1pL-tKIfKk');
    })();
  </script>
  <script>
    // ImgBB API Configuration (KEEP THIS!)
    const IMGBB_API_KEY = 'd2874cf23320c36b80524a4e065e1353';
    
    // Supabase Configuration - CONFIGURED FOR YOUR PROJECT
    const SUPABASE_URL = 'https://vpswhgppgyngxxxxvfkf.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_adjGINGJHz6FZZCEuarvLw_oFMpDKfX';
    
    // Initialize Supabase client
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #265df0;
      color: #fff;
    }
    #header {
      background-color: #1e4bb8;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    #header img {
      height: 50px;
      margin-right: 10px;
    }
    #header span {
      font-size: 1.8rem;
      font-weight: 600;
    }
    .container {
      padding: 20px;
    }
    .info-banner {
      background-color: #2196f3;
      color: #fff;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .success-banner {
      background-color: #4caf50;
      color: #fff;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .warning-banner {
      background-color: #ff9800;
      color: #000;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .pending-badge {
      background-color: #ff9800;
      color: #000;
      padding: 2px 8px;
      border-radius: 3px;
      font-size: 0.8em;
      font-weight: bold;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: #fff;
    }
    input[type="file"],
    input[type="email"],
    input[type="password"],
    input[type="text"],
    button {
      margin-right: 8px;
      padding: 6px 10px;
      font-size: 1rem;
    }
    button {
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .approve-btn {
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.8em;
      margin-right: 4px;
    }
    .approve-btn:hover {
      background-color: #45a049;
    }
    .reject-btn {
      background-color: #f44336;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.8em;
    }
    .reject-btn:hover {
      background-color: #da190b;
    }
    #status {
      margin-top: 10px;
      color: #c5d6ff;
    }
    #inventory-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 16px;
      margin-top: 20px;
    }
    .book-item {
      background-color: #fff;
      color: #000;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      text-align: center;
      position: relative;
    }
    .book-item.pending {
      border: 2px solid #ff9800;
      background-color: #fff3e0;
    }
    .book-item img {
      width: 100%;
      height: 220px;
      object-fit: contain;
      border-bottom: 1px solid #ddd;
    }
    .book-title {
      font-weight: bold;
      margin-top: 8px;
    }
    .book-email {
      font-size: 0.9em;
      color: #555;
      margin-top: 4px;
    }
    .delete-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background-color: #ff4444;
      color: white;
      border: none;
      border-radius: 3px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 0.8em;
    }
    .delete-btn:hover {
      background-color: #cc0000;
    }
    #search-input {
      padding: 6px 10px;
      width: 250px;
      margin-bottom: 10px;
      color: #000;
    }
    #storage-info {
      margin-top: 10px;
      font-size: 0.9em;
      color: #c5d6ff;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .password-help {
      font-size: 0.85em;
      color: #c5d6ff;
      margin-top: 4px;
    }
    .loading-spinner {
      display: inline-block;
      width: 14px;
      height: 14px;
      border: 2px solid #c5d6ff;
      border-top: 2px solid #265df0;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 8px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .admin-link {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-size: 0.8em;
      color: #c5d6ff;
      text-decoration: none;
    }
    .admin-link:hover {
      color: #fff;
    }
    #admin-panel {
      background-color: #1e4bb8;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
      display: none;
    }
    #admin-panel h3 {
      margin-top: 0;
    }
    .pending-count {
      background-color: #ff9800;
      color: #000;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.9em;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div id="header">
    <img src="images/logo.png" alt="My Book Share logo" onerror="this.style.display='none'">
    <span>mybookshare.com Inventory Page</span>
  </div>
  <div class="container">
    <div id="supabase-warning" class="warning-banner" style="display:none;">
      ‚ö†Ô∏è Supabase not configured. Please add your Supabase URL and Anon Key. See setup instructions.
    </div>
    
    <div class="success-banner">
      ‚úì Shared database enabled - all users see the same inventory!
    </div>
    
    <div class="info-banner">
      üìö All book uploads are reviewed by our team before appearing in the inventory. You'll receive an email once your book is approved!
    </div>
    
    <!-- Admin Panel (only visible when in admin mode) -->
    <div id="admin-panel">
      <h3>Admin Review Panel <span id="pending-count" class="pending-count">0</span></h3>
      <p>Review and approve pending book uploads below. Approved books will appear in the public inventory.</p>
      <div id="pending-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px;"></div>
    </div>
    
    <div>
      <div class="form-group">
        <label for="file-input">Upload book cover (JPG/PNG):</label>
        <input type="file" id="file-input" accept=".jpg,.jpeg,.png">
      </div>
      
      <div class="form-group">
        <label for="email-input">Your email (for interested readers to contact you):</label>
        <input type="email" id="email-input" placeholder="you@example.com">
      </div>
      
      <div class="form-group">
        <label for="password-input">Set a password (to delete your book later):</label>
        <input type="password" id="password-input" placeholder="Enter a password" minlength="4">
        <div class="password-help">Remember this password - you'll need it to delete your book after it's approved. Minimum 4 characters.</div>
      </div>
      
      <button id="upload-button" type="button">Upload &amp; Scan</button>
      <div id="status"></div>
      <div id="storage-info"></div>
    </div>
    <h2>Available Books</h2>
    <input type="text" id="search-input" placeholder="Search by title..." oninput="filterBooks()">
    <div id="inventory-grid"></div>
  </div>
  
  <a href="#" class="admin-link" onclick="enableAdminMode(); return false;">Admin</a>
  
  <script>
    // Admin mode variables
    let adminMode = false;
    const ADMIN_PASSWORD = 'admin123'; // CHANGE THIS TO A SECURE PASSWORD

    let books = [];

    // Check if Supabase is configured
    window.addEventListener('load', async function() {
      if (SUPABASE_URL === 'YOUR_SUPABASE_URL' || SUPABASE_ANON_KEY === 'YOUR_SUPABASE_ANON_KEY') {
        document.getElementById('supabase-warning').style.display = 'block';
      }
      
      await loadBooks();
      renderBooks();
      
      const urlParams = new URLSearchParams(window.location.search);
      const reviewId = urlParams.get('review');
      
      if (reviewId) {
        alert('Please click "Admin" in the bottom-right corner to review pending uploads.');
      }
    });

    // Upload image to ImgBB
    async function uploadToImgBB(file) {
      const formData = new FormData();
      formData.append('image', file);

      try {
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(`ImgBB upload failed: ${errorData.error?.message || response.statusText}`);
        }

        const data = await response.json();
        return data.data.url;
      } catch (error) {
        console.error('ImgBB upload error:', error);
        throw error;
      }
    }

    async function hashPassword(password) {
      const encoder = new TextEncoder();
      const data = encoder.encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    function validateEmail(email) {
      const re = /^\S+@\S+\.\S+$/;
      return re.test(email);
    }

    // Send admin review notification when book is uploaded
    function sendAdminReviewEmail(email, title, bookId) {
      const serviceID = 'service_hrwfurl';
      const templateID = 'template_9iyhtuo';
      const adminEmail = 'zdjimas@gmail.com';
      const reviewUrl = window.location.origin + window.location.pathname + '?review=' + bookId;
      const params = {
        to_email: adminEmail,
        admin_email: adminEmail,
        user_email: email,
        book_title: title,
        upload_date: new Date().toLocaleString(),
        review_url: reviewUrl,
        book_id: bookId
      };
      return emailjs.send(serviceID, templateID, params)
        .then(response => {
          console.log('Admin review email sent successfully', response.status);
          return true;
        })
        .catch(error => {
          console.error('Admin review email error:', error);
          alert('Warning: Failed to send admin notification email. Error: ' + error.text);
          return false;
        });
    }

    // Send approval notification to user when admin approves
    function sendApprovalNotificationEmail(email, title) {
      const serviceID = 'service_hrwfurl';
      const templateID = 'template_la29vmh';
      const params = {
        to_email: email,
        user_email: email,
        book_title: title,
        site_url: window.location.origin + window.location.pathname
      };
      return emailjs.send(serviceID, templateID, params)
        .then(response => {
          console.log('Approval notification sent successfully', response.status);
          return true;
        })
        .catch(error => {
          console.error('Approval notification error:', error);
          alert('Warning: Failed to send user approval email. Error: ' + error.text);
          return false;
        });
    }

    // Load books from Supabase
    async function loadBooks() {
      try {
        const { data, error } = await supabase
          .from('books')
          .select('*')
          .order('upload_date', { ascending: false });

        if (error) throw error;

        books = data || [];
        updateStorageInfo();
      } catch (e) {
        console.error('Error loading books from Supabase:', e);
        alert('Failed to load books. Please refresh the page.');
      }
    }

    // Save book to Supabase
    async function saveBook(book) {
      try {
        const { data, error } = await supabase
          .from('books')
          .insert([book])
          .select();

        if (error) throw error;

        return data[0];
      } catch (e) {
        console.error('Error saving book to Supabase:', e);
        alert('Failed to save book: ' + e.message);
        return null;
      }
    }

    // Update book in Supabase
    async function updateBook(id, updates) {
      try {
        const { data, error } = await supabase
          .from('books')
          .update(updates)
          .eq('id', id)
          .select();

        if (error) throw error;

        return data[0];
      } catch (e) {
        console.error('Error updating book in Supabase:', e);
        alert('Failed to update book: ' + e.message);
        return null;
      }
    }

    // Delete book from Supabase
    async function deleteBookFromDB(id) {
      try {
        const { error } = await supabase
          .from('books')
          .delete()
          .eq('id', id);

        if (error) throw error;

        return true;
      } catch (e) {
        console.error('Error deleting book from Supabase:', e);
        alert('Failed to delete book: ' + e.message);
        return false;
      }
    }

    function updateStorageInfo() {
      const info = document.getElementById('storage-info');
      const approvedCount = books.filter(b => b.status === 'approved').length;
      const pendingCount = books.filter(b => b.status === 'pending').length;
      info.textContent = `Books: ${approvedCount} approved, ${pendingCount} pending | Database: Supabase (shared across all devices!)`;
      
      if (adminMode) {
        document.getElementById('pending-count').textContent = pendingCount;
      }
    }

    async function approveBook(id) {
      const book = books.find(b => b.id === id);
      if (!book) return;
      
      if (confirm(`Approve "${book.title}" by ${book.email}?`)) {
        const updated = await updateBook(id, {
          status: 'approved',
          approved_date: new Date().toISOString()
        });
        
        if (updated) {
          await loadBooks();
          renderBooks();
          renderPendingBooks();
          
          sendApprovalNotificationEmail(book.email, book.title);
          
          alert('Book approved! User will be notified by email.');
        }
      }
    }

    async function rejectBook(id) {
      const book = books.find(b => b.id === id);
      if (!book) return;
      
      if (confirm(`Reject and delete "${book.title}" by ${book.email}?`)) {
        const deleted = await deleteBookFromDB(id);
        if (deleted) {
          await loadBooks();
          renderBooks();
          renderPendingBooks();
          alert('Book rejected and deleted.');
        }
      }
    }

    async function deleteBook(id) {
      const book = books.find(b => b.id === id);
      if (!book) return;
      
      if (adminMode) {
        if (confirm(`[ADMIN MODE] Delete "${book.title}" uploaded by ${book.email}?`)) {
          const deleted = await deleteBookFromDB(id);
          if (deleted) {
            await loadBooks();
            renderBooks();
            renderPendingBooks();
            alert('Book deleted by administrator.');
          }
        }
        return;
      }
      
      const password = prompt(`Enter the password you set when you uploaded "${book.title}":`);
      if (!password) return;
      
      const hashedInput = await hashPassword(password);
      
      if (hashedInput === book.password_hash) {
        if (confirm('Are you sure you want to delete this book?')) {
          const deleted = await deleteBookFromDB(id);
          if (deleted) {
            await loadBooks();
            renderBooks();
            alert('Book deleted successfully!');
          }
        }
      } else {
        alert('Incorrect password. Only the owner can delete this book.');
      }
    }

    function enableAdminMode() {
      const password = prompt('Enter admin password:');
      if (password === ADMIN_PASSWORD) {
        adminMode = true;
        document.getElementById('admin-panel').style.display = 'block';
        alert('Admin mode enabled. You can now review pending uploads and manage all books.');
        renderBooks();
        renderPendingBooks();
      } else {
        alert('Incorrect admin password.');
      }
    }

    function renderPendingBooks() {
      const grid = document.getElementById('pending-grid');
      grid.innerHTML = '';
      
      const pendingBooks = books.filter(b => b.status === 'pending');
      
      if (pendingBooks.length === 0) {
        grid.innerHTML = '<p style="color: #c5d6ff;">No pending uploads to review.</p>';
        return;
      }
      
      pendingBooks.forEach((book) => {
        const item = document.createElement('div');
        item.className = 'book-item pending';
        
        const img = document.createElement('img');
        img.src = book.image_url;
        img.alt = book.title;
        
        const titleEl = document.createElement('div');
        titleEl.className = 'book-title';
        titleEl.textContent = book.title;
        
        const emailEl = document.createElement('div');
        emailEl.className = 'book-email';
        emailEl.textContent = 'Uploader: ' + book.email;
        
        const dateEl = document.createElement('div');
        dateEl.style.fontSize = '0.8em';
        dateEl.style.color = '#666';
        dateEl.style.marginTop = '4px';
        dateEl.textContent = 'Uploaded: ' + new Date(book.upload_date).toLocaleDateString();
        
        const buttonContainer = document.createElement('div');
        buttonContainer.style.marginTop = '8px';
        
        const approveBtn = document.createElement('button');
        approveBtn.className = 'approve-btn';
        approveBtn.textContent = '‚úì Approve';
        approveBtn.onclick = () => approveBook(book.id);
        
        const rejectBtn = document.createElement('button');
        rejectBtn.className = 'reject-btn';
        rejectBtn.textContent = '‚úó Reject';
        rejectBtn.onclick = () => rejectBook(book.id);
        
        buttonContainer.appendChild(approveBtn);
        buttonContainer.appendChild(rejectBtn);
        
        item.appendChild(img);
        item.appendChild(titleEl);
        item.appendChild(emailEl);
        item.appendChild(dateEl);
        item.appendChild(buttonContainer);
        grid.appendChild(item);
      });
    }

    function renderBooks() {
      const grid = document.getElementById('inventory-grid');
      grid.innerHTML = '';
      
      const visibleBooks = adminMode ? books : books.filter(b => b.status === 'approved');
      
      if (visibleBooks.length === 0) {
        grid.innerHTML = '<p style="color: #c5d6ff; grid-column: 1 / -1;">No books available yet. Check back soon!</p>';
        return;
      }
      
      visibleBooks.forEach((book) => {
        const item = document.createElement('div');
        item.className = 'book-item';
        if (book.status === 'pending') {
          item.classList.add('pending');
        }
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = adminMode ? 'Admin Delete' : 'Delete';
        deleteBtn.onclick = () => deleteBook(book.id);
        
        const img = document.createElement('img');
        img.src = book.image_url;
        img.alt = book.title;
        img.onerror = function() {
          this.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="180" height="220"%3E%3Crect fill="%23ddd" width="180" height="220"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999"%3EImage not found%3C/text%3E%3C/svg%3E';
        };
        
        const titleEl = document.createElement('div');
        titleEl.className = 'book-title';
        titleEl.innerHTML = book.title;
        if (book.status === 'pending' && adminMode) {
          titleEl.innerHTML += ' <span class="pending-badge">PENDING</span>';
        }
        
        const emailEl = document.createElement('div');
        emailEl.className = 'book-email';
        emailEl.textContent = 'Contact: ' + book.email;
        
        item.appendChild(deleteBtn);
        item.appendChild(img);
        item.appendChild(titleEl);
        item.appendChild(emailEl);
        grid.appendChild(item);
      });
    }

    function filterBooks() {
      const query = document.getElementById('search-input').value.toLowerCase();
      const grid = document.getElementById('inventory-grid');
      grid.innerHTML = '';
      
      const visibleBooks = adminMode ? books : books.filter(b => b.status === 'approved');
      const filtered = visibleBooks.filter(book => book.title.toLowerCase().includes(query));
      
      if (filtered.length === 0) {
        grid.innerHTML = '<p style="color: #c5d6ff; grid-column: 1 / -1;">No books found matching your search.</p>';
        return;
      }
      
      filtered.forEach((book) => {
        const item = document.createElement('div');
        item.className = 'book-item';
        if (book.status === 'pending') {
          item.classList.add('pending');
        }
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = adminMode ? 'Admin Delete' : 'Delete';
        deleteBtn.onclick = () => deleteBook(book.id);
        
        const img = document.createElement('img');
        img.src = book.image_url;
        img.alt = book.title;
        img.onerror = function() {
          this.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="180" height="220"%3E%3Crect fill="%23ddd" width="180" height="220"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999"%3EImage not found%3C/text%3E%3C/svg%3E';
        };
        
        const titleEl = document.createElement('div');
        titleEl.className = 'book-title';
        titleEl.innerHTML = book.title;
        if (book.status === 'pending' && adminMode) {
          titleEl.innerHTML += ' <span class="pending-badge">PENDING</span>';
        }
        
        const emailEl = document.createElement('div');
        emailEl.className = 'book-email';
        emailEl.textContent = 'Contact: ' + book.email;
        
        item.appendChild(deleteBtn);
        item.appendChild(img);
        item.appendChild(titleEl);
        item.appendChild(emailEl);
        grid.appendChild(item);
      });
    }

    async function processUpload() {
      const fileInput = document.getElementById('file-input');
      const emailInput = document.getElementById('email-input');
      const passwordInput = document.getElementById('password-input');
      const uploadButton = document.getElementById('upload-button');
      const status = document.getElementById('status');
      
      if (!fileInput.files || fileInput.files.length === 0) {
        alert('Please select an image file (.jpg or .png).');
        return;
      }
      
      const file = fileInput.files[0];
      if (!['image/jpeg', 'image/png'].includes(file.type)) {
        alert('Only JPG and PNG images are allowed.');
        return;
      }
      
      const maxSize = 32 * 1024 * 1024;
      if (file.size > maxSize) {
        alert('Image file is too large. Please use an image smaller than 32MB.');
        return;
      }
      
      const email = emailInput.value.trim();
      if (!validateEmail(email)) {
        alert('Please enter a valid email address.');
        return;
      }
      
      const password = passwordInput.value.trim();
      if (!password || password.length < 4) {
        alert('Please enter a password (minimum 4 characters).');
        return;
      }
      
      uploadButton.disabled = true;
      
      try {
        // Step 1: Upload image to ImgBB
        status.innerHTML = 'Uploading image to ImgBB... <span class="loading-spinner"></span>';
        const imageUrl = await uploadToImgBB(file);
        console.log('Image uploaded to ImgBB:', imageUrl);
        
        // Step 2: Scan image with Tesseract
        status.innerHTML = 'Scanning image for text‚Ä¶ <span class="loading-spinner"></span>';
        const result = await Tesseract.recognize(imageUrl, 'eng', { logger: m => console.log(m) });
        status.textContent = 'Scan complete.';
        
        const lines = result.data.text.split('\n').map(l => l.trim()).filter(Boolean);
        let detectedTitle = lines.length > 0 ? lines.slice(0, 3).join(' ').substring(0, 100) : '';
        
        let title = '';
        while (!title || title.trim() === '') {
          title = prompt('Enter the book title (required):', detectedTitle);
          if (title === null) {
            alert('Book title is required. Upload cancelled.');
            uploadButton.disabled = false;
            return;
          }
          title = title.trim();
          if (title === '') {
            alert('Book title cannot be empty. Please enter a title.');
          }
        }
        
        const passwordHash = await hashPassword(password);
        const bookId = Date.now().toString();
        
        const book = {
          id: bookId,
          title: title,
          email: email,
          image_url: imageUrl,
          password_hash: passwordHash,
          upload_date: new Date().toISOString(),
          status: 'pending'
        };
        
        // Step 3: Save to Supabase
        status.innerHTML = 'Saving to database... <span class="loading-spinner"></span>';
        const savedBook = await saveBook(book);
        
        if (savedBook) {
          await loadBooks();
          renderBooks();
          if (adminMode) {
            renderPendingBooks();
          }
          
          status.textContent = 'Sending admin notification...';
          try {
            const emailSent = await sendAdminReviewEmail(email, title, bookId);
            if (emailSent) {
              status.textContent = 'Book submitted for review! The administrator has been notified.';
            } else {
              status.textContent = 'Book saved, but email notification failed. Please check browser console.';
            }
          } catch (emailError) {
            console.error('Email error:', emailError);
            status.textContent = 'Book saved, but email notification failed. Error: ' + emailError.message;
          }
          
          fileInput.value = '';
          emailInput.value = '';
          passwordInput.value = '';
        } else {
          status.textContent = 'Failed to save book to database.';
        }
      } catch (err) {
        console.error('Upload error:', err);
        status.textContent = 'Error: ' + err.message;
        alert('Upload failed: ' + err.message);
      } finally {
        uploadButton.disabled = false;
      }
    }

    document.getElementById('upload-button').addEventListener('click', processUpload);
  </script>
</body>
</html>
